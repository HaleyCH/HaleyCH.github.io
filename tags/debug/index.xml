<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Debug on HaleyCH çš„ä¸ªäººåšå®¢</title><link>https://hluvmiku.tech/tags/debug/</link><description>Recent content in Debug on HaleyCH çš„ä¸ªäººåšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 25 Oct 2023 15:36:23 +0800</lastBuildDate><atom:link href="https://hluvmiku.tech/tags/debug/index.xml" rel="self" type="application/rss+xml"/><item><title>Solve Multi Times Backwards In pytorch</title><link>https://hluvmiku.tech/blog/solve-multi-times-backwards-in-pytorch/</link><pubDate>Wed, 25 Oct 2023 15:36:23 +0800</pubDate><guid>https://hluvmiku.tech/blog/solve-multi-times-backwards-in-pytorch/</guid><description>&lt;img src="https://cdn.hluvmiku.tech//image/202310251611268.png" alt="Featured image of post Solve Multi Times Backwards In pytorch" />
&lt;div class="notice tip">
&lt;div class="notice-head">&lt;svg
width="20"
height="20"
viewBox="0 0 24 24"
fill="none"
xmlns="http://www.w3.org/2000/svg">
&lt;path
fillRule="evenodd"
clipRule="evenodd"
d="M12 0C18.6274 0 24 5.37258 24 12C24 18.6274 18.6274 24 12 24C5.37258 24 0 18.6274 0 12C0 5.37258 5.37258 0 12 0ZM12 2.4C6.69807 2.4 2.4 6.69807 2.4 12C2.4 17.3019 6.69807 21.6 12 21.6C17.3019 21.6 21.6 17.3019 21.6 12C21.6 6.69807 17.3019 2.4 12 2.4ZM15.9515 7.55147L9.6 13.9029L8.04853 12.3515C7.5799 11.8828 6.8201 11.8828 6.35147 12.3515C5.88284 12.8201 5.88284 13.5799 6.35147 14.0485L8.75147 16.4485C9.2201 16.9172 9.9799 16.9172 10.4485 16.4485L17.6485 9.24853C18.1172 8.7799 18.1172 8.0201 17.6485 7.55147C17.1799 7.08284 16.4201 7.08284 15.9515 7.55147Z"
fill="currentColor" />
&lt;/svg>&lt;p>Tip&lt;/p>
&lt;/div>
&lt;div class="notice-body">&lt;p>æœ¬æ–‡æä¾›äº†torchæŠ¥é”™&lt;code>Trying to backward through the graph a second time (or directly access saved tensors after they have already been freed&lt;/code>çš„æ·±å…¥æ’æŸ¥è§£å†³æ–¹æ¡ˆ&lt;/p>&lt;/div>
&lt;/div>
&lt;div class="notice note">
&lt;div class="notice-head">&lt;svg
width="20"
height="20"
viewBox="0 0 20 20"
fill="none"
xmlns="http://www.w3.org/2000/svg">
&lt;path
d="M10 9V14M10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10C19 14.9706 14.9706 19 10 19ZM10.0498 6V6.1L9.9502 6.1002V6H10.0498Z"
stroke="currentColor"
stroke-width="2"
stroke-linecap="round"
stroke-linejoin="round">&lt;/path>
&lt;/svg>&lt;p>Note&lt;/p>
&lt;/div>
&lt;div class="notice-body">&lt;p>&lt;p>æ’æŸ¥æ–¹æ³•æ‘˜è¦ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¡®è®¤æ˜¯å¦åœ¨ä¸€ä¸ªiterä¸­å¤šæ¬¡åå‘ä¼ æ’­&lt;/li>
&lt;li>ç¡®è®¤æ˜¯å¦åœ¨å¤šä¸ªitersä¹‹é—´æ²¡è°ƒç”¨optimizer.zero_grad()&lt;/li>
&lt;li>å¯è§†åŒ–å¹¶ç¡®è®¤æ˜¯å¦åŠæ—¶detach()äº†æ¨¡å‹å‚æ•°&lt;/li>
&lt;/ul>&lt;/p>&lt;/div>
&lt;/div>
&lt;h2 id="å‰è¨€">å‰è¨€
&lt;/h2>&lt;p>å®æ“pytorchä¹Ÿæœ‰å‡ å¹´äº†ï¼Œè™½ç„¶éƒ½æ˜¯å…´è¶£ä½¿ç„¶çš„å°æ‰“å°é—¹ï¼Œä½†æ˜¯å„ç§é—®é¢˜æˆ–å¤šæˆ–å°‘éƒ½ç¢°åˆ°è¿‡ã€‚&lt;br>
ä¸€èˆ¬æ¥è¯´ï¼Œç»å¤§å¤šæ•°torchçš„æŠ¥é”™éƒ½å¯ä»¥Googleåˆ°ï¼Œæˆ–è€…åœ¨StackOverflowä¸­æ‰¾åˆ°ç›¸å…³è§£å†³æ–¹æ¡ˆã€‚&lt;br>
å†ä¸æµï¼Œä¹Ÿå¯ä»¥å»GitHubé‡Œç›¸å…³issueä¸­æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œä½œä¸ºæœ€ç»ˆæ­¦å™¨ï¼Œæˆ‘ä»¬è¿˜æœ‰&lt;code>ChatGPT&lt;/code>ï¼Œåœ¨ç°åœ¨8kä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¾ˆä¸å¹¸ï¼Œæˆ‘é‡åˆ°çš„æ˜¯è¿™ä¸ªé”™è¯¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">RuntimeError: Trying to backward through the graph a second &lt;span class="nb">time&lt;/span> &lt;span class="o">(&lt;/span>or directly access saved tensors after they have already been freed&lt;span class="o">)&lt;/span>. Saved intermediate values of the graph are freed when you call .backward&lt;span class="o">()&lt;/span> or autograd.grad&lt;span class="o">()&lt;/span>. Specify &lt;span class="nv">retain_graph&lt;/span>&lt;span class="o">=&lt;/span>True &lt;span class="k">if&lt;/span> you need to backward through the graph a second &lt;span class="nb">time&lt;/span> or &lt;span class="k">if&lt;/span> you need to access saved tensors after calling backward.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä¸€å…±é‡åˆ°äº†3æ¬¡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä¹‹æ‰€ä»¥è¯´&lt;code>å¾ˆä¸å¹¸&lt;/code>ï¼Œæ˜¯å› ä¸ºå®ƒdebugèµ·æ¥æå…¶å›°éš¾ï¼Œæœ‰çš„æ—¶å€™è¿˜ä¼šæ²¦è½åˆ°ä¸å¾—ä¸å¯è§†åŒ–è®¡ç®—å›¾çš„åœ°æ­¥ã€‚
ç”šè‡³é—®GPTï¼Œå®ƒéƒ½åªä¼šç»™æˆ‘ç¬¼ç»Ÿåœ°è¯´æ£€æŸ¥æˆ‘æ˜¯ä¸æ˜¯backwardsäº†å¤šæ¬¡ä»€ä¹ˆçš„ï¼Œæ¯«æ— å‚è€ƒæ€§ã€‚&lt;/p>
&lt;p>è¿™ä¸ªé”™è¯¯çš„æ„æ€æ˜¯è¯´åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—å›¾åœ¨å®Œæˆåå‘ä¼ æ’­å‰å°±è¢«é‡Šæ”¾äº†ï¼Œå¯¼è‡´æ— æ³•å†æ¬¡åå‘ä¼ æ’­ã€‚&lt;br>
ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒGANæ—¶æ¯”è¾ƒå®¹æ˜“é‡åˆ°ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰é‡è¦è¢«è¦è¢«åå‘ä¼ æ’­è®­ç»ƒGå’ŒDä¸¤ä¸ªç½‘ç»œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±è€è€å®å®ä½¿ç”¨&lt;code>retain_graph=True&lt;/code>å°±å¥½äº†ã€‚&lt;/p>
&lt;p>å…¶ä»–æƒ…å†µè¯·æŒ‰ç…§ä¸‹æ–‡æ’æŸ¥ã€‚&lt;/p>
&lt;h2 id="å¸¸è§„æ£€æŸ¥">å¸¸è§„æ£€æŸ¥
&lt;/h2>&lt;p>åºŸè¯ä¸å¤šè¯´ï¼Œå†æ·±å…¥ç ”ç©¶ä»£ç å‰ï¼Œå…ˆç¡®å®šæ˜¯ä¸æ˜¯ç”±ä»¥ä¸‹é”™è¯¯å¯¼è‡´çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨ä¸€ä¸ªiterä¸­å¤šæ¬¡åå‘ä¼ æ’­ï¼Œå³ç±»ä¼¼ï¼š
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backwards&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># do something&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backwards&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>åœ¨å¤šä¸ªitersä¹‹é—´æ²¡è°ƒç”¨optimizer.zero_grad()ï¼Œå³ç±»ä¼¼ï¼š
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># do something&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backwards&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šè¿™ä¸¤ç§æƒ…å†µè¯·è‡ªè¡Œæ’æŸ¥è§£å†³ã€‚&lt;/p>
&lt;h2 id="ç»§ç»­æ·±å…¥">ç»§ç»­æ·±å…¥
&lt;/h2>
&lt;div class="notice note">
&lt;div class="notice-head">&lt;svg
width="20"
height="20"
viewBox="0 0 20 20"
fill="none"
xmlns="http://www.w3.org/2000/svg">
&lt;path
d="M10 9V14M10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10C19 14.9706 14.9706 19 10 19ZM10.0498 6V6.1L9.9502 6.1002V6H10.0498Z"
stroke="currentColor"
stroke-width="2"
stroke-linecap="round"
stroke-linejoin="round">&lt;/path>
&lt;/svg>&lt;p>Note&lt;/p>
&lt;/div>
&lt;div class="notice-body">&lt;p>&lt;p>&lt;strong>å…ˆè¯´ç»“è®ºï¼šæŸäº›è¯¥&lt;code>detach().clone()&lt;/code>çš„åœ°æ–¹æ²¡æœ‰&lt;code>detach().clone()&lt;/code>ã€‚&lt;/strong>&lt;/p>
&lt;p>å¦‚æœä¸çŸ¥é“æ˜¯å“ªé‡Œéœ€è¦&lt;code>detach().clone()&lt;/code>ï¼Œå¯ä»¥çœ‹æˆ‘ä¸‹æ–¹çš„å®è·µã€‚&lt;/p>
&lt;/p>&lt;/div>
&lt;/div>
&lt;p>æˆ‘æ²¡çŠ¯&lt;code>å¸¸è§„æ£€æŸ¥&lt;/code>ä¸­çš„ä¸¤ä¸ªé”™è¯¯ï¼Œä½†è¿˜æ˜¯å‡ºç°äº†è¿™ç§é—®é¢˜ğŸ¤”ã€‚&lt;br>
è¿«ä¸å¾—å·²ï¼Œæˆ‘ç»§ç»­æ·±å…¥ç ”ç©¶ã€‚&lt;/p>
&lt;p>æˆ‘å¾ˆå¿«å®šä½åˆ°é—®é¢˜å‡ºç°åœ¨è¿™ä¸€æ®µä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@property&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">get_xyz_purturbed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">unc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sample_from_grid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grid&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lb&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ub&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">noise&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">unc&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># pdb.set_trace()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">noise&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">noise&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">noise&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½†æ˜¯æˆ‘ä¸çŸ¥é“å…·ä½“é—®é¢˜å‡ºåœ¨å“ªã€‚&lt;/p>
&lt;p>è¢«æŠ˜ç£¨äº†å¥½ä¹…ğŸ˜©ï¼Œè¿«ä¸å¾—å·²æˆ‘è£…äº†ä¸ª&lt;code>torchviz&lt;/code>ï¼Œç”¨å®ƒçš„&lt;code>make_dot&lt;/code>å¯è§†åŒ–äº†ä¸€ä¸‹è®¡ç®—å›¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">make_dot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loss&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dot&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;loss.txt&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://cdn.hluvmiku.tech//image/202310251555198.png"
loading="lazy"
alt="202310251555198"
>
*&lt;strong>ä¸è¦åœ¨æ„æˆ‘ç”»çš„åœˆï¼Œè¿™æ˜¯æˆ‘ä¹‹å‰å’Œå­¦é•¿è®¨è®ºçš„æ—¶å€™ç•™ä¸‹æ¥çš„&lt;/strong>&lt;br>
ï¼ˆåœ¨çº¿å¯è§†åŒ–å·¥å…·&lt;a class="link" href="https://dreampuf.github.io/GraphvizOnline/" target="_blank" rel="noopener"
>åœ°å€&lt;/a>ï¼‰&lt;/p>
&lt;p>å…¶ä¸­ï¼Œè“è‰²çš„æ–¹æ¡†æ˜¯&lt;code>requires_grad=True&lt;/code>çš„æ¨¡å‹å‚æ•°ï¼Œæ©™è‰²çš„æ–¹æ¡†æ˜¯&lt;code>requires_grad=False&lt;/code>çš„ã€‚ç°è‰²å¾ˆæ˜¾ç„¶æ˜¯backwardsçš„èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>å› ä¸ºä¹‹å‰æˆ‘æµ‹è¯•è¿‡ï¼Œèƒ½ç¡®å®šé—®é¢˜å‡ºåœ¨å·¦è¾¹éƒ¨åˆ†çš„è®¡ç®—å›¾ï¼Œæˆ‘å¾ˆå¿«æ³¨æ„åˆ°äº†è¿™é‡Œï¼š
&lt;img src="https://cdn.hluvmiku.tech//image/202310251557820.png"
loading="lazy"
alt="202310251557820"
>&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™é‡Œå‡ºç°äº†ä¸¤ä¸ª&lt;code>requires_grad=True&lt;/code>çš„æ¨¡å‹å‚æ•°ï¼Œè¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨äº†ã€‚&lt;br>
&lt;strong>ä»¥ä¸‹æ˜¯æˆ‘å¯¹è¿™ä¸ªé—®é¢˜çš„ç†è§£ï¼Œå¯èƒ½æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚&lt;/strong>&lt;/p>
&lt;p>æˆ‘è®¤ä¸ºå‡ºç°è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¨¡å‹çš„è®¡ç®—å›¾æ˜¯ç±»ä¼¼äºæ ‘ä¸€æ ·çš„ç»“æ„ï¼ˆä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œå› ä¸ºéå¶å­ç»“ç‚¹ä¹‹é—´äº’ç›¸å¯ä»¥è¿æ¥ï¼‰ï¼Œæ ¹èŠ‚ç‚¹æ˜¯lossï¼Œå¶å­ç»“ç‚¹æ˜¯æ¨¡å‹å‚æ•°ï¼Œè€Œåƒè¿™æ ·çš„ç•¸å½¢ç»“æ„å¯¼è‡´torchæ— æ³•åœ¨æ­£ç¡®çš„æ—¶æœºé‡Šæ”¾è®¡ç®—å›¾ï¼Œä»è€Œå¯¼è‡´äº†è¿™ä¸ªé”™è¯¯ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘ä¼˜åŒ–äº†ä¸€ä¸‹ä»£ç ï¼Œå°†&lt;code>self._xyz&lt;/code>ï¼ˆè®¡ç®—å›¾ä¸­æœ€é¡¶ä¸Šé‚£ä¸ªè“è‰²æ–¹å—ï¼‰detachå¹¶å¤åˆ¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@property&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">get_xyz_purturbed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">unc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sample_from_grid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grid&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cpu&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">detach&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lb&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ub&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">noise&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">unc&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># pdb.set_trace()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">noise&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">noise&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">noise&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">_xyz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ ·å°±è§£å†³äº†é—®é¢˜ã€‚&lt;/p>
&lt;p>å¯ä»¥çœ‹çœ‹æˆ‘ä¿®æ”¹åçš„è®¡ç®—å›¾ï¼š
&lt;img src="https://cdn.hluvmiku.tech//image/202310251606170.png"
loading="lazy"
alt="202310251606170"
>
ååˆ†çš„å¹²å‡€åˆ©ç´¢ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“
&lt;/h2>&lt;p>å¤šæ¬¡åå‘ä¼ æ’­æ˜¯torchä¸­è¾ƒä¸ºæ£˜æ‰‹çš„é—®é¢˜ï¼Œéœ€è¦å¯¹torchçš„åå‘ä¼ æ’­æœ‰ä¸€å®šçš„ç†è§£ï¼Œå¹¶ä¸”è¦èƒ½å®Œå…¨æ˜ç¡®è‡ªå·±çš„æ¨¡å‹æ˜¯å¦‚ä½•backwardsçš„ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯è§†åŒ–è®¡ç®—å›¾çš„æ–¹å¼æ¥å¿«é€Ÿæ’æŸ¥ã€‚&lt;/p></description></item></channel></rss>